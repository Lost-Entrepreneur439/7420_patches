From f597cadaa7db2c6343c2b03ebfc1bdcd3ec63dae Mon Sep 17 00:00:00 2001
From: html6405 <peter.schelchshorn@mhs-solutions.at>
Date: Mon, 14 Feb 2022 16:39:56 +0100
Subject: [PATCH 12/14] SubscriptionInfoUpdater.java: set sim state absent and
 trigger radioreset for fakeiccid devices.

Change-Id: Iad83725d1d4d747e362a837f78be23044906b62a
---
 .../telephony/SubscriptionInfoUpdater.java         | 14 +++++++-------
 1 file changed, 7 insertions(+), 7 deletions(-)

diff --git a/src/java/com/android/internal/telephony/SubscriptionInfoUpdater.java b/src/java/com/android/internal/telephony/SubscriptionInfoUpdater.java
index 3c47258834..b2cca37d48 100644
--- a/src/java/com/android/internal/telephony/SubscriptionInfoUpdater.java
+++ b/src/java/com/android/internal/telephony/SubscriptionInfoUpdater.java
@@ -694,13 +694,13 @@ public class SubscriptionInfoUpdater extends Handler {
         }
         cleanSubscriptionInPhone(phoneId, true);
 
-        if (!RIL.needsOldRilFeature("fakeiccid")) {
-            broadcastSimStateChanged(phoneId, IccCardConstants.INTENT_VALUE_ICC_ABSENT, null);
-            broadcastSimCardStateChanged(phoneId, TelephonyManager.SIM_STATE_ABSENT);
-            broadcastSimApplicationStateChanged(phoneId, TelephonyManager.SIM_STATE_UNKNOWN);
-            updateSubscriptionCarrierId(phoneId, IccCardConstants.INTENT_VALUE_ICC_ABSENT);
-            updateCarrierServices(phoneId, IccCardConstants.INTENT_VALUE_ICC_ABSENT);
-        }
+        broadcastSimStateChanged(phoneId, IccCardConstants.INTENT_VALUE_ICC_ABSENT, null);
+        broadcastSimCardStateChanged(phoneId, TelephonyManager.SIM_STATE_ABSENT);
+        broadcastSimApplicationStateChanged(phoneId, TelephonyManager.SIM_STATE_UNKNOWN);
+        updateSubscriptionCarrierId(phoneId, IccCardConstants.INTENT_VALUE_ICC_ABSENT);
+        updateCarrierServices(phoneId, IccCardConstants.INTENT_VALUE_ICC_ABSENT);
+        if (!RIL.needsOldRilFeature("fakeiccid"))
+            SystemProperties.set("gsm.radioreset", "true");
     }
 
     protected void handleSimError(int phoneId) {
-- 
2.37.1

