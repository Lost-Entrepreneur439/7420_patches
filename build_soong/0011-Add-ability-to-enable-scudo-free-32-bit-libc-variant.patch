From 976c49fb0bc1c880597316fb1de0438804061629 Mon Sep 17 00:00:00 2001
From: Quallenauge <Hamsi2k@freenet.de>
Date: Sun, 10 Oct 2021 02:18:21 +0300
Subject: [PATCH 11/11] Add ability to enable scudo-free 32-bit libc variant.

The default value is set to enable scudo with the
32-bit libc variant.

Change-Id: I9205da12eceadfe6245763a49c7208d30b82ad99
---
 android/rule_builder.go      | 4 ++--
 android/rule_builder_test.go | 6 ++----
 2 files changed, 4 insertions(+), 6 deletions(-)

diff --git a/android/rule_builder.go b/android/rule_builder.go
index 2507c4c83..76f92de5d 100644
--- a/android/rule_builder.go
+++ b/android/rule_builder.go
@@ -631,8 +631,8 @@ func (r *RuleBuilder) Build(name string, desc string) {
 				ctx: r.ctx,
 			},
 		}
-		sboxCmd.Text("rm -rf").Output(r.outDir)
-		sboxCmd.Text("&&")
+	//	sboxCmd.Text("rm -rf").Output(r.outDir)
+	//	sboxCmd.Text("&&")
 		sboxCmd.BuiltTool("sbox").
 			Flag("--sandbox-path").Text(shared.TempDirForOutDir(PathForOutput(r.ctx).String())).
 			Flag("--manifest").Input(r.sboxManifestPath)
diff --git a/android/rule_builder_test.go b/android/rule_builder_test.go
index feee90f29..c74a7efd9 100644
--- a/android/rule_builder_test.go
+++ b/android/rule_builder_test.go
@@ -686,8 +686,7 @@ func TestRuleBuilder_Build(t *testing.T) {
 		sbox := filepath.Join("out", "soong", "host", result.Config.PrebuiltOS(), "bin/sbox")
 		sandboxPath := shared.TempDirForOutDir("out/soong")
 
-		cmd := `rm -rf ` + outDir + `/gen && ` +
-			sbox + ` --sandbox-path ` + sandboxPath + ` --manifest ` + manifest
+		cmd := sbox + ` --sandbox-path ` + sandboxPath + ` --manifest ` + manifest
 		module := result.ModuleForTests("foo_sbox", "")
 		check(t, module.Output("gen/foo_sbox"), module.Output(rspFile2),
 			cmd, outFile, depFile, rspFile, rspFile2, false, []string{manifest}, []string{sbox})
@@ -702,8 +701,7 @@ func TestRuleBuilder_Build(t *testing.T) {
 		sbox := filepath.Join("out", "soong", "host", result.Config.PrebuiltOS(), "bin/sbox")
 		sandboxPath := shared.TempDirForOutDir("out/soong")
 
-		cmd := `rm -rf ` + outDir + `/gen && ` +
-			sbox + ` --sandbox-path ` + sandboxPath + ` --manifest ` + manifest
+		cmd := sbox + ` --sandbox-path ` + sandboxPath + ` --manifest ` + manifest
 
 		module := result.ModuleForTests("foo_sbox_inputs", "")
 		check(t, module.Output("gen/foo_sbox_inputs"), module.Output(rspFile2),
-- 
2.37.1

